!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("md5"),require("localforage")):"function"==typeof define&&define.amd?define(["md5","localforage"],t):"object"==typeof exports?exports.flacheClient=t(require("md5"),require("localforage")):e.flacheClient=t(e.md5,e.localforage)}(self,((e,t)=>(()=>{"use strict";var r={428:e=>{e.exports=t},99:t=>{t.exports=e}},n={};function s(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return r[e](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{s.r(o),s.d(o,{default:()=>y});class e extends Response{#e;#t;#r;constructor(e,t){super(e,t),this.#e=t.redirected||!1,this.#r=t.url||"",this.#t=t.type||"default"}get url(){return this.#r}get redirected(){return this.#e}get type(){return this.#t}}function t(t){const r={...t.response,headers:new Headers(t.response.headers)};return new e(JSON.stringify(t.data.data),r)}const r={method:"GET",mode:"cors",cache:"default",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"follow",referrerPolicy:"no-referrer-when-downgrade",body:null};var n=s(99),i=s.n(n);function a(e){const t=e.entries(),r={};for(const[e,n]of t)r[e]=n;return r}const c=async function(e){const t=function(e,t=["body"]){if(!(e instanceof Response))throw new Error("Not a valid response object");const r={};for(const n in e)t.includes(n)||"function"==typeof e[n]||(r[n]="headers"!==n?e[n]:a(e[n]));return r}(e),r=await async function(e){try{return{type:"json",data:await e.json()}}catch(t){return console.log(t.message),async function(e){try{return{type:"text",data:await e.text()}}catch(t){return console.log(t.message),async function(e){try{return{type:"blob",data:await e.blob()}}catch(t){return console.log(t.message),async function(e){try{return{type:"buffer",data:await e.arrayBuffer()}}catch(e){return console.log(e.message),null}}(e)}}(e)}}(e)}}(e);if(!r)throw new Error("failed to parse data");return{response:t,data:r}};var l=s(428),h=s.n(l);class u{constructor(e,t){this.key=e,this.value=t,this.next=null,this.prev=null}}const d={_driver:"FLACHESTORAGE",_initStorage:function(e,t){if(this.capacity=e,this.cache=new Map,this.head=null,this.tail=null,t)for(let e in t)this.cache[e]=t[e];return Promise.resolve()},clear:function(e){return new Promise(((e,t)=>{try{this.cache.clear(),e(!0)}catch(e){t(e)}}))},getItem:function(e){return this.printLL(),new Promise(((t,r)=>{try{if(this.cache.has(e)){let r=this.cache.get(e);return this.moveToFront(r),t(r.value)}return t(null)}catch(e){r(e)}}))},iterate:function(e,t){},key:function(e,t){return new Promise(((r,n)=>{try{if(e<0||!this.head)return r(null);0===e&&(t||r(this.head.key),r(t(this.head.key)));let n=this.head,s=0;for(;n&&(n=n.next,s++,s!==e););s<e&&r(null),t||r(n.key),r(t(n.key))}catch(e){n(e)}}))},keys:function(e){return new Promise(((t,r)=>{try{const r=this.cache.keys();e||t([...r]),t(e([...r]))}catch(e){r(e)}}))},length:function(e){return this.keys().then((t=>{const r=t.length;return e?e(r):r}))},removeItem:function(e,t){return delete this.cache[e],Promise.resolve()},setItem:function(e,t){return new Promise(((r,n)=>{try{if(this.cache.has(e)){let n=this.cache.get(e);n.value=t,this.moveToFront(n),r(t)}let n=new u(e,t);this.cache.size===this.capacity&&(this.cache.delete(this.tail.key),this.deleteNode(this.tail)),this.cache.set(e,n),this.addFirst(n),r(t)}catch(e){n(e)}}))},moveToFront:function(e){this.deleteNode(e),this.addFirst(e)},deleteNode:function(e){let t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t},addFirst:function(e){e.next=this.head,e.prev=null,this.head&&(this.head.prev=e),this.head=e,this.tail||(this.tail=e)},printLL:function(){console.log("This is our Linked List \n",this.head)}};h().defineDriver(d);const f={maxCapacity:null,ttl:5e3,config:{name:"httpCache",storeName:"request_response",description:"A cache for client-side http requests",driver:[d._driver,h().INDEXEDDB,h().LOCALSTORAGE],version:1}};class p{constructor(e=f){this.store=h().createInstance({...f.config,...e.config}),this.details=h().createInstance({name:"cacheDetails",storeName:"requests",description:"A list of past requests",version:1}),this.ttl=e.ttl||f.ttl,this.maxCapacity=e.maxCapacity}static INDEXEDDB=h().INDEXEDDB;static LOCALSTORAGE=h().LOCALSTORAGE;static MEMORY="FLACHESTORAGE"}p.prototype.flacheRequest=async function(e,n){n={...r,...n};let s=this.generateKey(e,n);const o=await this.store.getItem(s).then((e=>e?this.validateCache(s,e):null)).catch((e=>e));if(!o){const r=await this.getFetchRequest(e,n);return r?(r.ttl=Date.now()+this.ttl,await this.store.setItem(s,r),t(r)):null}return t(o)},p.prototype.generateKey=(e,t)=>{const r=t.method.toUpperCase();if("GET"===r)return`${r}/${e}`;if("POST"===r){if(!Object.hasOwn(t,"body"))throw new Error("Must include a body with POST request");return`${r}/${i()(JSON.stringify(t.body))}/${e}`}},p.prototype.validateCache=async function(e,t){return t.ttl<Date.now()?(await this.store.removeItem(e),null):t},p.prototype.getFetchRequest=async function(e,t){return await fetch(e,t).then((e=>c(e))).catch((e=>(console.log("Fetch error",e.message),e)))};const y=p})(),o})()));
//# sourceMappingURL=bundle.js.map
